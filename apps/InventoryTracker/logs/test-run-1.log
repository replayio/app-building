
> inventory-tracker@1.0.0 test
> tsx scripts/test.ts tests/dashboard.spec.ts


--- Killing stale processes ---

--- Cleaning up stale test branches ---

--- Creating ephemeral branch: test-worker-1771969301986-5xp2i3 ---
Branch created: br-bitter-sun-aij9ral4

--- Initializing schema on test branch ---
Schema initialized.

--- Seeding test data ---
Seed data inserted successfully.

--- Removing stale recordings ---

--- Running Playwright: tests/dashboard.spec.ts ---
[2m[WebServer] [22m[33mâ ‹[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[1G[2m[WebServer] [22m[33mâ ™[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[1G[2m[WebServer] [22m[33mâ ¹[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[32mâˆš[39m Vite dev server ready on port 5173

Running 35 tests using 2 workers

[2m[WebServer] [22m(node:16447) [DEP0060] DeprecationWarning: The `util._extend` API is deprecated. Please use Object.assign() instead.
[2m[WebServer] [22m(Use `node --trace-deprecation ...` to show where the warning was created)
  âœ“   2 tests/dashboard.spec.ts:33:3 â€º NavigationHeader â€º Navigation link for Accounts navigates to AccountsPage (1.8s)
  âœ“   1 tests/dashboard.spec.ts:4:3 â€º NavigationHeader â€º Navigation header displays app branding and all navigation links (2.3s)
  âœ“   3 tests/dashboard.spec.ts:43:3 â€º NavigationHeader â€º Navigation link for Materials navigates to MaterialsPage (1.1s)
  âœ“   4 tests/dashboard.spec.ts:53:3 â€º NavigationHeader â€º Navigation link for Batches navigates to batch listing (1.1s)
  âœ“   5 tests/dashboard.spec.ts:63:3 â€º NavigationHeader â€º Navigation link for Transactions navigates to TransactionsPage (1.1s)
  âœ“   6 tests/dashboard.spec.ts:73:3 â€º NavigationHeader â€º Navigation link for Settings navigates to Settings page (1.1s)
  âœ“   7 tests/dashboard.spec.ts:83:3 â€º NavigationHeader â€º Active navigation link is visually highlighted for the current page (1.3s)
  âœ“   8 tests/dashboard.spec.ts:103:3 â€º LowInventoryAlerts â€º Low inventory alerts section displays with heading and warning icon (2.0s)
  âœ“   9 tests/dashboard.spec.ts:281:3 â€º MaterialsCategoriesOverview â€º Materials categories overview section displays with heading and icon (2.1s)
  âœ“  10 tests/dashboard.spec.ts:113:3 â€º LowInventoryAlerts â€º Each low inventory alert shows severity, material name, current quantity, and reorder point (4.3s)
  âœ“  12 tests/dashboard.spec.ts:173:3 â€º LowInventoryAlerts â€º Low inventory alert View Details link navigates to material detail page (2.1s)
  âœ˜  11 tests/dashboard.spec.ts:290:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count (18.4s)
  âœ˜  13 tests/dashboard.spec.ts:193:3 â€º LowInventoryAlerts â€º Low inventory alert Dismiss button removes the alert (17.0s)
  -  15 tests/dashboard.spec.ts:226:3 â€º LowInventoryAlerts â€º Low inventory alert Reorder button opens new transaction pre-filled for reorder
  -  16 tests/dashboard.spec.ts:250:3 â€º LowInventoryAlerts â€º Low inventory alerts section shows empty state when no materials are below reorder point
  âœ“  17 tests/dashboard.spec.ts:342:3 â€º MaterialsCategoriesOverview â€º Clicking a material name navigates to the material detail page (2.0s)
  âœ“  18 tests/dashboard.spec.ts:363:3 â€º MaterialsCategoriesOverview â€º View All Categories link navigates to MaterialsPage (2.0s)
  âœ˜  14 tests/dashboard.spec.ts:319:3 â€º MaterialsCategoriesOverview â€º Each category shows a sample of materials with names and quantities (17.1s)
  âœ“  20 tests/dashboard.spec.ts:398:3 â€º RecentTransactionsTable â€º Recent transactions table displays with correct column headers (2.4s)
  âœ“  21 tests/dashboard.spec.ts:417:3 â€º RecentTransactionsTable â€º Recent transactions table shows transaction rows with correct data (2.0s)
  âœ˜  19 tests/dashboard.spec.ts:373:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied (17.3s)
  âœ˜  22 tests/dashboard.spec.ts:436:3 â€º RecentTransactionsTable â€º Recent transactions table shows multiple transactions in reverse chronological order (2.5s)
  âœ“  23 tests/dashboard.spec.ts:464:3 â€º RecentTransactionsTable â€º View Full Details link navigates to TransactionDetailPage (2.1s)
  âœ“  24 tests/dashboard.spec.ts:483:3 â€º RecentTransactionsTable â€º View All Transactions link navigates to TransactionsPage (2.1s)
  âœ˜  25 tests/dashboard.spec.ts:493:3 â€º RecentTransactionsTable â€º Recent transactions table updates when date range filter is applied (3.0s)
  âœ“  26 tests/dashboard.spec.ts:531:3 â€º RecentTransactionsTable â€º Recent transactions table shows empty state when no transactions exist (3.3s)
  âœ“  28 tests/dashboard.spec.ts:565:3 â€º DateRangeFilter â€º Clicking the date range picker opens a calendar to select dates (2.5s)
  âœ“  27 tests/dashboard.spec.ts:550:3 â€º DateRangeFilter â€º Date range filter displays with label, date range, and calendar icon (3.1s)
  âœ˜  29 tests/dashboard.spec.ts:581:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets (2.6s)
  âœ“  30 tests/dashboard.spec.ts:615:3 â€º CategoryFilter â€º Category filter displays as a dropdown with "All Categories" default (3.0s)
  âœ“  32 tests/dashboard.spec.ts:628:3 â€º CategoryFilter â€º Opening the category filter dropdown lists all material categories (2.3s)
  âœ˜  31 tests/dashboard.spec.ts:658:3 â€º CategoryFilter â€º Selecting a category filters dashboard content to that category (17.2s)
  âœ˜  33 tests/dashboard.spec.ts:683:3 â€º CategoryFilter â€º Selecting "All Categories" resets the filter to show all data (17.2s)
  âœ“  34 tests/dashboard.spec.ts:713:3 â€º NewTransactionButton â€º New Transaction button is displayed prominently with plus icon (1.9s)
  âœ“  35 tests/dashboard.spec.ts:729:3 â€º NewTransactionButton â€º Clicking New Transaction button navigates to NewTransactionPage (1.7s)
[replay.io]: Finishing up. This should only take a moment ...



  1) tests/dashboard.spec.ts:193:3 â€º LowInventoryAlerts â€º Low inventory alert Dismiss button removes the alert 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoHaveCount[2m([22m[32mexpected[39m[2m)[22m failed

    Locator:  locator('[data-testid^=\'low-inventory-alert-row-\']').filter({ has: locator('[data-testid^=\'low-inventory-alert-material-name-\']').filter({ hasText: 'Copper Wire' }) })
    Expected: [32m0[39m
    Received: [31m1[39m
    Timeout:  15000ms

    Call log:
    [2m  - Expect "toHaveCount" with timeout 15000ms[22m
    [2m  - waiting for locator('[data-testid^=\'low-inventory-alert-row-\']').filter({ has: locator('[data-testid^=\'low-inventory-alert-material-name-\']').filter({ hasText: 'Copper Wire' }) })[22m
    [2m    18 Ã— locator resolved to 1 element[22m
    [2m       - unexpected value "1"[22m


      215 |         has: page.locator("[data-testid^='low-inventory-alert-material-name-']", { hasText: "Copper Wire" }),
      216 |       })
    > 217 |     ).toHaveCount(0, { timeout: 15000 });
          |       ^
      218 |
      219 |     // Other alerts should still be visible (at least one remains)
      220 |     const alertsAfter = page.locator("[data-testid^='low-inventory-alert-row-']");
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:217:7

    Error Context: test-results/dashboard-LowInventoryAler-18e09-ss-button-removes-the-alert/error-context.md

  2) tests/dashboard.spec.ts:290:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: getByTestId('category-column-name-name-e7727c62-173e-46da-85e6-c409ce659f95')
    Expected: visible
    Timeout: 15000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 15000ms[22m
    [2m  - waiting for getByTestId('category-column-name-name-e7727c62-173e-46da-85e6-c409ce659f95')[22m


      306 |
      307 |       // Category name
    > 308 |       await expect(page.getByTestId(`category-column-name-${catId}`)).toBeVisible();
          |                                                                       ^
      309 |
      310 |       // Totals showing Items and Units
      311 |       const totals = page.getByTestId(`category-column-totals-${catId}`);
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:308:71

    Error Context: test-results/dashboard-MaterialsCategor-42959-count-and-total-units-count/error-context.md

  3) tests/dashboard.spec.ts:319:3 â€º MaterialsCategoriesOverview â€º Each category shows a sample of materials with names and quantities 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator: locator('[data-testid^=\'category-material-\']').nth(1).locator('[data-testid^=\'category-material-link-\']')
    Expected: visible
    Timeout: 15000ms
    Error: element(s) not found

    Call log:
    [2m  - Expect "toBeVisible" with timeout 15000ms[22m
    [2m  - waiting for locator('[data-testid^=\'category-material-\']').nth(1).locator('[data-testid^=\'category-material-link-\']')[22m


      333 |       // Material should contain a link with material name and quantity info
      334 |       const link = material.locator("[data-testid^='category-material-link-']");
    > 335 |       await expect(link).toBeVisible();
          |                          ^
      336 |       // Text should include name and quantity
      337 |       const text = await material.textContent();
      338 |       expect(text).toMatch(/.+:\s*[\d,]+\s+\w+/);
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:335:26

    Error Context: test-results/dashboard-MaterialsCategor-11812-s-with-names-and-quantities/error-context.md

  4) tests/dashboard.spec.ts:373:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoHaveCount[2m([22m[32mexpected[39m[2m)[22m failed

    Locator:  locator('[data-testid^=\'category-column-\']')
    Expected: [32m1[39m
    Received: [31m3[39m
    Timeout:  15000ms

    Call log:
    [2m  - Expect "toHaveCount" with timeout 15000ms[22m
    [2m  - waiting for locator('[data-testid^=\'category-column-\']')[22m
    [2m    4 Ã— locator resolved to 12 elements[22m
    [2m      - unexpected value "12"[22m
    [2m    14 Ã— locator resolved to 3 elements[22m
    [2m       - unexpected value "3"[22m


      391 |
      392 |     // After filtering, only one category column should be visible
    > 393 |     await expect(page.locator("[data-testid^='category-column-']")).toHaveCount(1, { timeout: 15000 });
          |                                                                     ^
      394 |   });
      395 | });
      396 |
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:393:69

    Error Context: test-results/dashboard-MaterialsCategor-41d5a--category-filter-is-applied/error-context.md

  5) tests/dashboard.spec.ts:436:3 â€º RecentTransactionsTable â€º Recent transactions table shows multiple transactions in reverse chronological order 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBeGreaterThanOrEqual[2m([22m[32mexpected[39m[2m)[22m

    Expected: >= [32mNaN[39m
    Received:    [31mNaN[39m

      458 |       const prev = new Date(dates[i - 1]).getTime();
      459 |       const curr = new Date(dates[i]).getTime();
    > 460 |       expect(prev).toBeGreaterThanOrEqual(curr);
          |                    ^
      461 |     }
      462 |   });
      463 |
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:460:20

    Error Context: test-results/dashboard-RecentTransactio-1016b-reverse-chronological-order/error-context.md

  6) tests/dashboard.spec.ts:493:3 â€º RecentTransactionsTable â€º Recent transactions table updates when date range filter is applied 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"2026"[39m
    Received string:    [31m"Invalid Date"[39m

      524 |       const txnId = rowTestId!.replace("recent-transaction-row-", "");
      525 |       const dateText = await page.getByTestId(`recent-transaction-date-${txnId}`).textContent();
    > 526 |       expect(dateText).toContain("2026");
          |                        ^
      527 |       expect(dateText).toContain("Jan");
      528 |     }
      529 |   });
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:526:24

    Error Context: test-results/dashboard-RecentTransactio-3056b-ate-range-filter-is-applied/error-context.md

  7) tests/dashboard.spec.ts:581:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"Feb"[39m
    Received string:    [31m"Invalid Date"[39m

      603 |       const txnId = rowTestId!.replace("recent-transaction-row-", "");
      604 |       const dateText = await page.getByTestId(`recent-transaction-date-${txnId}`).textContent();
    > 605 |       expect(dateText).toContain("Feb");
          |                        ^
      606 |     }
      607 |
      608 |     // Low inventory alerts and categories overview should still be visible
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:605:24

    Error Context: test-results/dashboard-DateRangeFilter--436d4-dates-all-dashboard-widgets/error-context.md

  8) tests/dashboard.spec.ts:658:3 â€º CategoryFilter â€º Selecting a category filters dashboard content to that category 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoHaveCount[2m([22m[32mexpected[39m[2m)[22m failed

    Locator:  locator('[data-testid^=\'category-column-\']')
    Expected: [32m1[39m
    Received: [31m3[39m
    Timeout:  15000ms

    Call log:
    [2m  - Expect "toHaveCount" with timeout 15000ms[22m
    [2m  - waiting for locator('[data-testid^=\'category-column-\']')[22m
    [2m    4 Ã— locator resolved to 12 elements[22m
    [2m      - unexpected value "12"[22m
    [2m    14 Ã— locator resolved to 3 elements[22m
    [2m       - unexpected value "3"[22m


      674 |
      675 |     // Categories overview should show only Raw Materials
    > 676 |     await expect(page.locator("[data-testid^='category-column-']")).toHaveCount(1, { timeout: 15000 });
          |                                                                     ^
      677 |
      678 |     const singleColumn = page.locator("[data-testid^='category-column-']").first();
      679 |     const colName = singleColumn.locator("[data-testid^='category-column-name-']");
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:676:69

    Error Context: test-results/dashboard-CategoryFilter-S-7f440-rd-content-to-that-category/error-context.md

  9) tests/dashboard.spec.ts:683:3 â€º CategoryFilter â€º Selecting "All Categories" resets the filter to show all data 

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoHaveCount[2m([22m[32mexpected[39m[2m)[22m failed

    Locator:  locator('[data-testid^=\'category-column-\']')
    Expected: [32m1[39m
    Received: [31m3[39m
    Timeout:  15000ms

    Call log:
    [2m  - Expect "toHaveCount" with timeout 15000ms[22m
    [2m  - waiting for locator('[data-testid^=\'category-column-\']')[22m
    [2m    4 Ã— locator resolved to 12 elements[22m
    [2m      - unexpected value "12"[22m
    [2m    14 Ã— locator resolved to 3 elements[22m
    [2m       - unexpected value "3"[22m


      695 |
      696 |     // Should be filtered to 1
    > 697 |     await expect(page.locator("[data-testid^='category-column-']")).toHaveCount(1, { timeout: 15000 });
          |                                                                     ^
      698 |
      699 |     // Now select All Categories
      700 |     await page.getByTestId("category-filter-trigger").click();
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:697:69

    Error Context: test-results/dashboard-CategoryFilter-S-ad636-the-filter-to-show-all-data/error-context.md

  9 failed
    tests/dashboard.spec.ts:193:3 â€º LowInventoryAlerts â€º Low inventory alert Dismiss button removes the alert 
    tests/dashboard.spec.ts:290:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count 
    tests/dashboard.spec.ts:319:3 â€º MaterialsCategoriesOverview â€º Each category shows a sample of materials with names and quantities 
    tests/dashboard.spec.ts:373:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied 
    tests/dashboard.spec.ts:436:3 â€º RecentTransactionsTable â€º Recent transactions table shows multiple transactions in reverse chronological order 
    tests/dashboard.spec.ts:493:3 â€º RecentTransactionsTable â€º Recent transactions table updates when date range filter is applied 
    tests/dashboard.spec.ts:581:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets 
    tests/dashboard.spec.ts:658:3 â€º CategoryFilter â€º Selecting a category filters dashboard content to that category 
    tests/dashboard.spec.ts:683:3 â€º CategoryFilter â€º Selecting "All Categories" resets the filter to show all data 
  2 did not run
  24 passed (1.8m)

Playwright exited with code 1

=== REPLAY RECORDINGS METADATA ===
{"id":"63efd8a1-9b1e-4f0c-a7cf-10bc5a6f0425","testResult":"passed"}
{"id":"f9450f6d-41de-4898-a078-1235d59d82bc","testResult":"passed"}
{"id":"d30dc5ea-4c63-468b-ab2c-1122e934713a","testResult":"passed"}
{"id":"c6659f62-b2d7-4bea-b7ff-0e6684552c30","testResult":"passed"}
{"id":"dd56be05-9427-4e1e-ba9a-a3e5369ba7c5","testResult":"passed"}
{"id":"f6b18b2e-0ece-4af3-ac98-c739b7eb2479","testResult":"passed"}
{"id":"bfaea48b-d76f-484b-bfe3-d69028bbe479","testResult":"passed"}
{"id":"89f1eead-86af-4558-9c14-566634700d84","testResult":"passed"}
{"id":"6ef14e71-437c-400d-b255-af995fb526b4","testResult":"passed"}
{"id":"e82cd275-c03d-4546-9175-29c791694501","testResult":"passed"}
{"id":"c4705a2f-fbdd-48a1-8ec0-9dd6978b11a4","testResult":"failed"}
{"id":"87ab99f2-1f22-470b-b34c-24783222fd70","testResult":"passed"}
{"id":"b282e163-1546-40c7-9c16-9e0758795562","testResult":"failed"}
{"id":"96642a2f-8fc6-4b17-a43f-bada573fa3e2","testResult":"failed"}
{"id":"6cb06e71-b939-41af-96b0-0d712a244673","testResult":"passed"}
{"id":"0da4471d-0115-4011-a6f3-17e78b3bb26d","testResult":"passed"}
{"id":"01e36915-8335-4c6c-91b8-ff812aa09af9","testResult":"failed"}
{"id":"4d051d31-5f4b-4b7d-8814-f6e09ef4907a","testResult":"passed"}
{"id":"e6703d96-38d5-44d1-815d-e94036abf8c8","testResult":"passed"}
{"id":"45b4c6b2-e9c0-4b9e-b6f6-3b55e893c511","testResult":"failed"}
{"id":"69080115-09a1-4a6b-aeff-f32b9744d8e4","testResult":"passed"}
{"id":"7e5fe48b-92b4-43fb-a551-577db88a462a","testResult":"passed"}
{"id":"cfeb6a20-5bf5-4e6d-876f-ed8016f1f891","testResult":"failed"}
{"id":"f57ca44a-2210-4dd7-af2a-94ca9fed02ab","testResult":"passed"}
{"id":"725f1daa-dc68-45de-91d4-0f21716eb0f2","testResult":"passed"}
{"id":"f4f2b6c6-5529-4570-bca1-4d467820ab4d","testResult":"passed"}
{"id":"fbefb84e-57fb-49d3-9291-afe0f982a77f","testResult":"failed"}
{"id":"657f0971-5ed2-4f8b-8a6d-2942ba394f2f","testResult":"passed"}
{"id":"62f23c69-d631-4deb-9f3c-b7ae5dd7282d","testResult":"failed"}
{"id":"45f90349-0c32-41a8-8f04-48c9fac38df3","testResult":"passed"}
{"id":"4b14e87a-e291-4761-8b19-abdbaf22ef6f","testResult":"failed"}
{"id":"fa537bf7-f73c-4706-b88d-b57ed865319f","testResult":"passed"}
{"id":"11ec1863-7866-4af5-8d19-58c3daf08c14","testResult":"passed"}
=== END REPLAY RECORDINGS METADATA ===

Uploading recording c4705a2f-fbdd-48a1-8ec0-9dd6978b11a4 (duration: 0)...
â ™ Initializingâ€¦
Uploading recordings...
   c4705a2fâ€¦  Each category column shows category name, total itâ€¦  1m ago  18s   

Uploaded recordings
 âœ”  c4705a2fâ€¦  Each category column shows category name, total itâ€¦  1m ago  18s  (uploaded) 

View recording at:
https://app.replay.io/recording/c4705a2f-fbdd-48a1-8ec0-9dd6978b11a4
REPLAY UPLOADED: c4705a2f-fbdd-48a1-8ec0-9dd6978b11a4

--- Cleaning up ---
Deleting ephemeral branch: test-worker-1771969301986-5xp2i3
