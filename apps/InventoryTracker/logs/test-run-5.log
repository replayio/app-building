
> inventory-tracker@1.0.0 test
> tsx scripts/test.ts tests/dashboard.spec.ts


--- Killing stale processes ---

--- Cleaning up stale test branches ---
Deleting stale branch: test-worker-1771971002000-uucgij

--- Creating ephemeral branch: test-worker-1771971720956-4y8ojy ---
Branch created: br-aged-salad-ai8rxe58

--- Initializing schema on test branch ---
Schema initialized.

--- Seeding test data ---
Seed data inserted successfully.

--- Removing stale recordings ---

--- Running Playwright: tests/dashboard.spec.ts ---
[2m[WebServer] [22m[33mâ ‹[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[1G[2m[WebServer] [22m[33mâ ™[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[1G[2m[WebServer] [22m[33mâ ¹[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[1G[2m[WebServer] [22m[33mâ ¸[39m Waiting for Vite dev server to be ready on port 5173
[2m[WebServer] [22m[32mâˆš[39m Vite dev server ready on port 5173

Running 35 tests using 2 workers

[2m[WebServer] [22m(node:21739) [DEP0060] DeprecationWarning: The `util._extend` API is deprecated. Please use Object.assign() instead.
[2m[WebServer] [22m(Use `node --trace-deprecation ...` to show where the warning was created)
  âœ“   1 tests/dashboard.spec.ts:33:3 â€º NavigationHeader â€º Navigation link for Accounts navigates to AccountsPage (1.7s)
  âœ“   2 tests/dashboard.spec.ts:4:3 â€º NavigationHeader â€º Navigation header displays app branding and all navigation links (2.3s)
  âœ“   3 tests/dashboard.spec.ts:43:3 â€º NavigationHeader â€º Navigation link for Materials navigates to MaterialsPage (14.3s)
  âœ“   4 tests/dashboard.spec.ts:53:3 â€º NavigationHeader â€º Navigation link for Batches navigates to batch listing (26.7s)
  âœ“   5 tests/dashboard.spec.ts:63:3 â€º NavigationHeader â€º Navigation link for Transactions navigates to TransactionsPage (26.2s)
  âœ“   6 tests/dashboard.spec.ts:73:3 â€º NavigationHeader â€º Navigation link for Settings navigates to Settings page (27.0s)
  âœ“   7 tests/dashboard.spec.ts:83:3 â€º NavigationHeader â€º Active navigation link is visually highlighted for the current page (31.3s)
  âœ“   8 tests/dashboard.spec.ts:103:3 â€º LowInventoryAlerts â€º Low inventory alerts section displays with heading and warning icon (33.0s)
  âœ“   9 tests/dashboard.spec.ts:282:3 â€º MaterialsCategoriesOverview â€º Materials categories overview section displays with heading and icon (33.4s)
  âœ˜  10 tests/dashboard.spec.ts:113:3 â€º LowInventoryAlerts â€º Each low inventory alert shows severity, material name, current quantity, and reorder point (1.1m)
  -  12 tests/dashboard.spec.ts:173:3 â€º LowInventoryAlerts â€º Low inventory alert View Details link navigates to material detail page
  -  13 tests/dashboard.spec.ts:193:3 â€º LowInventoryAlerts â€º Low inventory alert Dismiss button removes the alert
  -  14 tests/dashboard.spec.ts:226:3 â€º LowInventoryAlerts â€º Low inventory alert Reorder button opens new transaction pre-filled for reorder
  -  15 tests/dashboard.spec.ts:250:3 â€º LowInventoryAlerts â€º Low inventory alerts section shows empty state when no materials are below reorder point
  âœ˜  11 tests/dashboard.spec.ts:291:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count (1.1m)
  âœ“  16 tests/dashboard.spec.ts:320:3 â€º MaterialsCategoriesOverview â€º Each category shows a sample of materials with names and quantities (40.3s)
  âœ“  17 tests/dashboard.spec.ts:343:3 â€º MaterialsCategoriesOverview â€º Clicking a material name navigates to the material detail page (41.0s)
  âœ“  18 tests/dashboard.spec.ts:364:3 â€º MaterialsCategoriesOverview â€º View All Categories link navigates to MaterialsPage (42.4s)
  âœ“  20 tests/dashboard.spec.ts:399:3 â€º RecentTransactionsTable â€º Recent transactions table displays with correct column headers (39.0s)
  âœ˜  19 tests/dashboard.spec.ts:374:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied (1.1m)
  âœ“  21 tests/dashboard.spec.ts:418:3 â€º RecentTransactionsTable â€º Recent transactions table shows transaction rows with correct data (26.2s)
  âœ“  22 tests/dashboard.spec.ts:465:3 â€º RecentTransactionsTable â€º View Full Details link navigates to TransactionDetailPage (14.4s)
  âœ“  23 tests/dashboard.spec.ts:437:3 â€º RecentTransactionsTable â€º Recent transactions table shows multiple transactions in reverse chronological order (23.5s)
  âœ“  24 tests/dashboard.spec.ts:484:3 â€º RecentTransactionsTable â€º View All Transactions link navigates to TransactionsPage (12.9s)
  âœ“  26 tests/dashboard.spec.ts:533:3 â€º RecentTransactionsTable â€º Recent transactions table shows empty state when no transactions exist (18.6s)
  âœ“  25 tests/dashboard.spec.ts:494:3 â€º RecentTransactionsTable â€º Recent transactions table updates when date range filter is applied (28.7s)
  âœ“  27 tests/dashboard.spec.ts:552:3 â€º DateRangeFilter â€º Date range filter displays with label, date range, and calendar icon (10.6s)
  âœ“  28 tests/dashboard.spec.ts:567:3 â€º DateRangeFilter â€º Clicking the date range picker opens a calendar to select dates (13.5s)
  âœ“  30 tests/dashboard.spec.ts:617:3 â€º CategoryFilter â€º Category filter displays as a dropdown with "All Categories" default (14.0s)
  âœ“  31 tests/dashboard.spec.ts:630:3 â€º CategoryFilter â€º Opening the category filter dropdown lists all material categories (13.0s)
  âœ˜  29 tests/dashboard.spec.ts:583:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets (39.8s)
  âœ“  32 tests/dashboard.spec.ts:660:3 â€º CategoryFilter â€º Selecting a category filters dashboard content to that category (18.2s)
  âœ“  34 tests/dashboard.spec.ts:716:3 â€º NewTransactionButton â€º New Transaction button is displayed prominently with plus icon (48.6s)
  âœ“  33 tests/dashboard.spec.ts:685:3 â€º CategoryFilter â€º Selecting "All Categories" resets the filter to show all data (1.3m)
  âœ“  35 tests/dashboard.spec.ts:732:3 â€º NewTransactionButton â€º Clicking New Transaction button navigates to NewTransactionPage (31.8s)
[replay.io]: Finishing up. This should only take a moment ...



  1) tests/dashboard.spec.ts:113:3 â€º LowInventoryAlerts â€º Each low inventory alert shows severity, material name, current quantity, and reorder point 

    [31mTest timeout of 60000ms exceeded.[39m

    Error: [2mexpect([22m[31mlocator[39m[2m).[22mtoBeVisible[2m([22m[2m)[22m failed

    Locator:  getByTestId('low-inventory-alert-reorder-point-a2ac6cc8-957a-4025-bc5d-e97da5f3be1b')
    Expected: visible
    Received: undefined

    Call log:
    [2m  - Expect "toBeVisible" with timeout 15000ms[22m
    [2m  - waiting for getByTestId('low-inventory-alert-reorder-point-a2ac6cc8-957a-4025-bc5d-e97da5f3be1b')[22m


      143 |
      144 |       // Reorder point
    > 145 |       await expect(page.getByTestId(`low-inventory-alert-reorder-point-${materialId}`)).toBeVisible();
          |                                                                                         ^
      146 |     }
      147 |
      148 |     // Verify specific severity assignments based on seed data
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:145:89

    Error Context: test-results/dashboard-LowInventoryAler-bd415--quantity-and-reorder-point/error-context.md

  2) tests/dashboard.spec.ts:291:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count 

    [31mTest timeout of 60000ms exceeded.[39m

    Error Context: test-results/dashboard-MaterialsCategor-42959-count-and-total-units-count/error-context.md

  3) tests/dashboard.spec.ts:374:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied 

    [31mTest timeout of 60000ms exceeded.[39m

    Error Context: test-results/dashboard-MaterialsCategor-41d5a--category-filter-is-applied/error-context.md

  4) tests/dashboard.spec.ts:583:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets 

    TimeoutError: locator.getAttribute: Timeout 15000ms exceeded.
    Call log:
    [2m  - waiting for locator('[data-testid^=\'recent-transaction-row-\']').nth(3)[22m


      602 |     for (let i = 0; i < count; i++) {
      603 |       const row = rows.nth(i);
    > 604 |       const rowTestId = await row.getAttribute("data-testid");
          |                                   ^
      605 |       const txnId = rowTestId!.replace("recent-transaction-row-", "");
      606 |       const dateText = await page.getByTestId(`recent-transaction-date-${txnId}`).textContent();
      607 |       expect(dateText).toContain("Feb");
        at /repo/apps/InventoryTracker/tests/dashboard.spec.ts:604:35

    Error Context: test-results/dashboard-DateRangeFilter--436d4-dates-all-dashboard-widgets/error-context.md

  4 failed
    tests/dashboard.spec.ts:113:3 â€º LowInventoryAlerts â€º Each low inventory alert shows severity, material name, current quantity, and reorder point 
    tests/dashboard.spec.ts:291:3 â€º MaterialsCategoriesOverview â€º Each category column shows category name, total items count, and total units count 
    tests/dashboard.spec.ts:374:3 â€º MaterialsCategoriesOverview â€º Materials categories overview updates when category filter is applied 
    tests/dashboard.spec.ts:583:3 â€º DateRangeFilter â€º Selecting a new date range updates all dashboard widgets 
  4 did not run
  27 passed (9.4m)

Playwright exited with code 1

=== REPLAY RECORDINGS METADATA ===
{"id":"891a2998-149f-4c67-a5bc-0caad443a233","testResult":"passed"}
{"id":"155f2d42-cf7b-45d7-8759-a554ec0f69d2","testResult":"passed"}
{"id":"8c05e564-1e3a-4a80-97b5-59649ea322de","testResult":"passed"}
{"id":"b43e6d0f-f558-4b98-b7ed-e91c82f69c89","testResult":"passed"}
{"id":"ea391bf4-3040-4d63-9692-d0a0cb4c17ac","testResult":"passed"}
{"id":"7e9c4b63-8a65-4f0c-a062-a263165fcf74","testResult":"passed"}
{"id":"7c688e35-58f1-49ef-bdf9-1dec90e380eb","testResult":"passed"}
{"id":"4bdaa686-4f49-467f-a233-ccfc9a1900f5","testResult":"passed"}
{"id":"26e99a74-ad89-4da7-a76d-37dacdb09566","testResult":"passed"}
{"id":"aa554dd4-669f-4e47-aab9-036b0eb8847d","testResult":"timedOut"}
{"id":"3a798f83-7e67-4eac-a38a-5338c9358781","testResult":"timedOut"}
{"id":"73f598c9-6632-4b17-a819-cc0804fce078","testResult":"passed"}
{"id":"22c56fd2-8bca-4c81-8031-69f747cccfcd","testResult":"passed"}
{"id":"f9763216-717e-477d-ae4d-637af0a473fa","testResult":"passed"}
{"id":"22678cd2-7896-42d7-bfae-6b098aa95231","testResult":"timedOut"}
{"id":"fa6e6aad-379e-45e7-8a85-bb6058e82384","testResult":"passed"}
{"id":"3ea86a66-5a4c-4e21-a254-76ad86ded9bf","testResult":"passed"}
{"id":"e2c2c3bb-cbb0-4439-bf93-073cbf4b9245","testResult":"passed"}
{"id":"592ab61c-0cb1-49e6-82c2-689d5478cd30","testResult":"passed"}
{"id":"689652ba-3a47-4779-a061-d10f6292881a","testResult":"passed"}
{"id":"4b6b3bd0-7bc2-41a6-8201-0e99379bb73e","testResult":"passed"}
{"id":"b7e6292f-71df-4e86-bafa-ebacfcaab18b","testResult":"passed"}
{"id":"bfc5b02f-42c0-4412-b39f-4c6ef2e3c0f2","testResult":"passed"}
{"id":"b405fe99-c01c-4190-84f2-8dfc51faacae","testResult":"passed"}
{"id":"59b60406-b32e-4cbf-ae81-28d158fb6376","testResult":"failed"}
{"id":"d9b4a51e-7027-47a3-8743-9703456584d3","testResult":"passed"}
{"id":"04251ed6-9160-4c94-a8e5-a1d17bcd513c","testResult":"passed"}
{"id":"f2b68465-d201-487d-a785-cabcab8b1ce5","testResult":"passed"}
{"id":"fd457cee-7948-49c7-b91f-55b64e77c792","testResult":"passed"}
{"id":"141f3823-8039-4244-bb15-66e1288d664b","testResult":"passed"}
{"id":"a4f62382-90db-425b-aed0-040fb2b6c0a5","testResult":"passed"}
=== END REPLAY RECORDINGS METADATA ===

Uploading recording aa554dd4-669f-4e47-aab9-036b0eb8847d (duration: 0)...
â ™ Initializingâ€¦
Uploading recordings...
   aa554dd4â€¦  Each low inventory alert shows severity, materialâ€¦  7m ago  59s   

Uploaded recordings
 âœ”  aa554dd4â€¦  Each low inventory alert shows severity, materialâ€¦  7m ago  59s  (uploaded) 

View recording at:
https://app.replay.io/recording/aa554dd4-669f-4e47-aab9-036b0eb8847d
REPLAY UPLOADED: aa554dd4-669f-4e47-aab9-036b0eb8847d

--- Cleaning up ---
Deleting ephemeral branch: test-worker-1771971720956-4y8ojy
Test script failed: TypeError: fetch failed
    at node:internal/deps/undici/undici:14902:13
    at async deleteBranch (/repo/apps/InventoryTracker/scripts/test.ts:76:15)
    at async main (/repo/apps/InventoryTracker/scripts/test.ts:310:5) {
  [cause]: Error: write ETIMEDOUT
      at WriteWrap.onWriteComplete [as oncomplete] (node:internal/stream_base_commons:87:19)
      at handleWriteReq (node:internal/stream_base_commons:59:21)
      at writeGeneric (node:internal/stream_base_commons:148:15)
      at Socket._writeGeneric (node:net:966:11)
      at Socket._write (node:net:978:8)
      at writeOrBuffer (node:internal/streams/writable:572:12)
      at _write (node:internal/streams/writable:501:10)
      at Writable.write (node:internal/streams/writable:510:10)
      at writeBuffer (node:internal/deps/undici/undici:6714:20)
      at writeH1 (node:internal/deps/undici/undici:6616:9) {
    errno: -110,
    code: 'ETIMEDOUT',
    syscall: 'write'
  }
}
